<app-navbar></app-navbar>

<div class="panel-container">
  <!-- Header del Panel -->
  <div class="panel-header">
    <div class="header-info">
      <div class="empresa-logo">ğŸ¢</div>
      <div class="empresa-detalles">
        <h1>{{ perfilProveedor?.nombre_empresa }}</h1>
        <p class="usuario-info">{{ usuario?.username }} â€¢ {{ perfilProveedor?.ciudad }}</p>
      </div>
    </div>
    <div class="header-stats">
      <div class="stat-item">
        <span class="stat-numero">{{ totalProductos }}</span>
        <span class="stat-label">Productos</span>
      </div>
    </div>
  </div>

  <!-- PestaÃ±as de NavegaciÃ³n -->
  <div class="panel-tabs">
    <button 
      class="tab-button" 
      [class.active]="pestanaActiva === 'resumen'"
      (click)="cambiarPestana('resumen')"
    >
      ğŸ“Š Resumen
    </button>
    <button 
      class="tab-button" 
      [class.active]="pestanaActiva === 'servicios'"
      (click)="cambiarPestana('servicios')"
    >
      ğŸµ Servicios ({{ servicios.length }})
    </button>
    <button 
      class="tab-button" 
      [class.active]="pestanaActiva === 'vestidos'"
      (click)="cambiarPestana('vestidos')"
    >
      ğŸ‘— Vestidos ({{ vestidosNovia.length }})
    </button>
    <button 
      class="tab-button" 
      [class.active]="pestanaActiva === 'trajes'"
      (click)="cambiarPestana('trajes')"
    >
      ğŸ¤µ Trajes ({{ trajesNovio.length }})
    </button>
    <button 
      class="tab-button" 
      [class.active]="pestanaActiva === 'complementos-novia'"
      (click)="cambiarPestana('complementos-novia')"
    >
      ğŸ’ Compl. Novia ({{ complementosNovia.length }})
    </button>
    <button 
      class="tab-button" 
      [class.active]="pestanaActiva === 'complementos-novio'"
      (click)="cambiarPestana('complementos-novio')"
    >
      ğŸ‘” Compl. Novio ({{ complementosNovio.length }})
    </button>
  </div>

  <!-- Contenido del Panel -->
  <div class="panel-content">
    
    <!-- PESTAÃ‘A: RESUMEN -->
    <div *ngIf="pestanaActiva === 'resumen'" class="contenido-resumen">
      <h2>ğŸ“Š Resumen de tu CatÃ¡logo</h2>
      
      <div class="resumen-grid">
        <div class="resumen-card" (click)="cambiarPestana('servicios')">
          <div class="card-icon">ğŸµ</div>
          <h3>Servicios</h3>
          <p class="card-numero">{{ servicios.length }}</p>
          <button class="btn-gestionar">Gestionar</button>
        </div>

        <div class="resumen-card" (click)="cambiarPestana('vestidos')">
          <div class="card-icon">ğŸ‘—</div>
          <h3>Vestidos de Novia</h3>
          <p class="card-numero">{{ vestidosNovia.length }}</p>
          <button class="btn-gestionar">Gestionar</button>
        </div>

        <div class="resumen-card" (click)="cambiarPestana('trajes')">
          <div class="card-icon">ğŸ¤µ</div>
          <h3>Trajes de Novio</h3>
          <p class="card-numero">{{ trajesNovio.length }}</p>
          <button class="btn-gestionar">Gestionar</button>
        </div>

        <div class="resumen-card" (click)="cambiarPestana('complementos-novia')">
          <div class="card-icon">ğŸ’</div>
          <h3>Complementos Novia</h3>
          <p class="card-numero">{{ complementosNovia.length }}</p>
          <button class="btn-gestionar">Gestionar</button>
        </div>

        <div class="resumen-card" (click)="cambiarPestana('complementos-novio')">
          <div class="card-icon">ğŸ‘”</div>
          <h3>Complementos Novio</h3>
          <p class="card-numero">{{ complementosNovio.length }}</p>
          <button class="btn-gestionar">Gestionar</button>
        </div>
      </div>

      <div class="info-proveedor">
        <h3>â„¹ï¸ InformaciÃ³n de tu Empresa</h3>
        <div class="info-grid">
          <div class="info-item">
            <strong>TelÃ©fono:</strong> {{ perfilProveedor?.telefono || 'No especificado' }}
          </div>
          <div class="info-item">
            <strong>Email:</strong> {{ usuario?.email || 'No especificado' }}
          </div>
          <div class="info-item">
            <strong>DirecciÃ³n:</strong> {{ perfilProveedor?.direccion || 'No especificado' }}
          </div>
          <div class="info-item">
            <strong>CIF/NIF:</strong> {{ perfilProveedor?.cif_nif || 'No especificado' }}
          </div>
        </div>
      </div>
    </div>

    <!-- PESTAÃ‘A: SERVICIOS -->
    <div *ngIf="pestanaActiva === 'servicios'" class="contenido-seccion">
      <div class="seccion-header">
        <h2>ğŸµ Mis Servicios</h2>
        <button class="btn-nuevo" (click)="abrirFormulario('servicio')">
          â• Nuevo Servicio
        </button>
      </div>

      <div class="productos-grid" *ngIf="servicios.length > 0">
        <div class="producto-card" *ngFor="let servicio of servicios">
          <div class="producto-imagen">
            <img [src]="servicio.imagen || 'https://via.placeholder.com/300x200?text=Servicio'" [alt]="servicio.nombre">
          </div>
          <div class="producto-info">
            <h3>{{ servicio.nombre }}</h3>
            <p class="precio">{{ servicio.precio }}â‚¬</p>
            <p class="categoria">{{ servicio.categoria_nombre }}</p>
            <div class="producto-acciones">
              <button class="btn-eliminar" (click)="eliminarProducto('servicio', servicio.id)">
                ğŸ—‘ï¸ Eliminar
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="sin-productos" *ngIf="servicios.length === 0">
        <p>ğŸ“­ No tienes servicios publicados todavÃ­a</p>
        <button class="btn-crear" (click)="abrirFormulario('servicio')">Crear mi primer servicio</button>
      </div>
    </div>

    <!-- PESTAÃ‘A: VESTIDOS -->
    <div *ngIf="pestanaActiva === 'vestidos'" class="contenido-seccion">
      <div class="seccion-header">
        <h2>ğŸ‘— Mis Vestidos de Novia</h2>
        <button class="btn-nuevo" (click)="abrirFormulario('vestido')">
          â• Nuevo Vestido
        </button>
      </div>

      <div class="productos-grid" *ngIf="vestidosNovia.length > 0">
        <div class="producto-card" *ngFor="let vestido of vestidosNovia">
          <div class="producto-imagen">
            <img [src]="vestido.imagen_principal" [alt]="vestido.nombre">
          </div>
          <div class="producto-info">
            <h3>{{ vestido.nombre }}</h3>
            <p class="marca">{{ vestido.marca }}</p>
            <p class="precio">{{ vestido.precio }}â‚¬</p>
            <p class="estilo">{{ vestido.estilo }}</p>
            <div class="producto-acciones">
              <button class="btn-eliminar" (click)="eliminarProducto('vestido', vestido.id)">
                ğŸ—‘ï¸ Eliminar
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="sin-productos" *ngIf="vestidosNovia.length === 0">
        <p>ğŸ“­ No tienes vestidos publicados todavÃ­a</p>
        <button class="btn-crear" (click)="abrirFormulario('vestido')">Crear mi primer vestido</button>
      </div>
    </div>

    <!-- PESTAÃ‘A: TRAJES -->
    <div *ngIf="pestanaActiva === 'trajes'" class="contenido-seccion">
      <div class="seccion-header">
        <h2>ğŸ¤µ Mis Trajes de Novio</h2>
        <button class="btn-nuevo" (click)="abrirFormulario('traje')">
          â• Nuevo Traje
        </button>
      </div>

      <div class="productos-grid" *ngIf="trajesNovio.length > 0">
        <div class="producto-card" *ngFor="let traje of trajesNovio">
          <div class="producto-imagen">
            <img [src]="traje.imagen_principal" [alt]="traje.nombre">
          </div>
          <div class="producto-info">
            <h3>{{ traje.nombre }}</h3>
            <p class="marca">{{ traje.marca }}</p>
            <p class="precio">{{ traje.precio }}â‚¬</p>
            <p class="tipo">{{ traje.tipo }}</p>
            <div class="producto-acciones">
              <button class="btn-eliminar" (click)="eliminarProducto('traje', traje.id)">
                ğŸ—‘ï¸ Eliminar
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="sin-productos" *ngIf="trajesNovio.length === 0">
        <p>ğŸ“­ No tienes trajes publicados todavÃ­a</p>
        <button class="btn-crear" (click)="abrirFormulario('traje')">Crear mi primer traje</button>
      </div>
    </div>

    <!-- PESTAÃ‘A: COMPLEMENTOS NOVIA -->
    <div *ngIf="pestanaActiva === 'complementos-novia'" class="contenido-seccion">
      <div class="seccion-header">
        <h2>ğŸ’ Mis Complementos de Novia</h2>
        <button class="btn-nuevo" (click)="abrirFormulario('complemento-novia')">
          â• Nuevo Complemento
        </button>
      </div>

      <div class="productos-grid" *ngIf="complementosNovia.length > 0">
        <div class="producto-card" *ngFor="let complemento of complementosNovia">
          <div class="producto-imagen">
            <img [src]="complemento.imagen_principal" [alt]="complemento.nombre">
          </div>
          <div class="producto-info">
            <h3>{{ complemento.nombre }}</h3>
            <p class="precio">{{ complemento.precio }}â‚¬</p>
            <p class="categoria">{{ complemento.categoria }}</p>
            <div class="producto-acciones">
              <button class="btn-eliminar" (click)="eliminarProducto('complemento-novia', complemento.id)">
                ğŸ—‘ï¸ Eliminar
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="sin-productos" *ngIf="complementosNovia.length === 0">
        <p>ğŸ“­ No tienes complementos publicados todavÃ­a</p>
        <button class="btn-crear" (click)="abrirFormulario('complemento-novia')">Crear mi primer complemento</button>
      </div>
    </div>

    <!-- PESTAÃ‘A: COMPLEMENTOS NOVIO -->
    <div *ngIf="pestanaActiva === 'complementos-novio'" class="contenido-seccion">
      <div class="seccion-header">
        <h2>ğŸ‘” Mis Complementos de Novio</h2>
        <button class="btn-nuevo" (click)="abrirFormulario('complemento-novio')">
          â• Nuevo Complemento
        </button>
      </div>

      <div class="productos-grid" *ngIf="complementosNovio.length > 0">
        <div class="producto-card" *ngFor="let complemento of complementosNovio">
          <div class="producto-imagen">
            <img [src]="complemento.imagen_principal" [alt]="complemento.nombre">
          </div>
          <div class="producto-info">
            <h3>{{ complemento.nombre }}</h3>
            <p class="precio">{{ complemento.precio }}â‚¬</p>
            <p class="categoria">{{ complemento.categoria }}</p>
            <div class="producto-acciones">
              <button class="btn-eliminar" (click)="eliminarProducto('complemento-novio', complemento.id)">
                ğŸ—‘ï¸ Eliminar
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="sin-productos" *ngIf="complementosNovio.length === 0">
        <p>ğŸ“­ No tienes complementos publicados todavÃ­a</p>
        <button class="btn-crear" (click)="abrirFormulario('complemento-novio')">Crear mi primer complemento</button>
      </div>
    </div>

  </div>
</div>

<!-- MODAL: FORMULARIO DE NUEVO PRODUCTO -->
<div class="modal-overlay" *ngIf="mostrarFormulario" (click)="cerrarFormulario()">
  <div class="modal-contenido" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ tipoFormulario === 'servicio' ? 'ğŸµ Nuevo Servicio' :
             tipoFormulario === 'vestido' ? 'ğŸ‘— Nuevo Vestido' :
             tipoFormulario === 'traje' ? 'ğŸ¤µ Nuevo Traje' :
             tipoFormulario === 'complemento-novia' ? 'ğŸ’ Nuevo Complemento Novia' :
             'ğŸ‘” Nuevo Complemento Novio' }}</h2>
      <button class="btn-cerrar" (click)="cerrarFormulario()">âœ•</button>
    </div>

    <form (ngSubmit)="guardarProducto()" class="formulario-producto">
      <!-- Campos Comunes -->
      <div class="form-group">
        <label>Nombre *</label>
        <input type="text" [(ngModel)]="nuevoProducto.nombre" name="nombre" required>
      </div>

      <div class="form-row" *ngIf="tipoFormulario === 'vestido' || tipoFormulario === 'traje'">
        <div class="form-group">
          <label>Marca *</label>
          <input type="text" [(ngModel)]="nuevoProducto.marca" name="marca">
        </div>
        <div class="form-group">
          <label>Color</label>
          <input type="text" [(ngModel)]="nuevoProducto.color" name="color">
        </div>
      </div>

      <div class="form-group">
        <label>Precio (â‚¬) *</label>
        <input type="number" [(ngModel)]="nuevoProducto.precio" name="precio" min="0" step="0.01" required>
      </div>

      <!-- CategorÃ­a para Servicios -->
      <div class="form-group" *ngIf="tipoFormulario === 'servicio'">
        <label>CategorÃ­a *</label>
        <select [(ngModel)]="nuevoProducto.categoria" name="categoria">
          <option [value]="null">Selecciona una categorÃ­a</option>
          <option *ngFor="let cat of categoriasServicio" [value]="cat.id">{{ cat.nombre }}</option>
        </select>
      </div>

      <!-- Estilo para Vestidos -->
      <div class="form-group" *ngIf="tipoFormulario === 'vestido'">
        <label>Estilo</label>
        <select [(ngModel)]="nuevoProducto.estilo" name="estilo">
          <option *ngFor="let estilo of estilosVestido" [value]="estilo">{{ estilo }}</option>
        </select>
      </div>

      <!-- Tipo para Trajes -->
      <div class="form-group" *ngIf="tipoFormulario === 'traje'">
        <label>Tipo</label>
        <select [(ngModel)]="nuevoProducto.tipo" name="tipo">
          <option *ngFor="let tipo of tiposTraje" [value]="tipo">{{ tipo }}</option>
        </select>
      </div>

      <!-- CategorÃ­a para Complementos -->
      <div class="form-group" *ngIf="tipoFormulario === 'complemento-novia'">
        <label>CategorÃ­a *</label>
        <select [(ngModel)]="nuevoProducto.categoria_complemento" name="categoria_complemento">
          <option value="">Selecciona una categorÃ­a</option>
          <option *ngFor="let cat of categoriasComplementoNovia" [value]="cat">{{ cat }}</option>
        </select>
      </div>

      <div class="form-group" *ngIf="tipoFormulario === 'complemento-novio'">
        <label>CategorÃ­a *</label>
        <select [(ngModel)]="nuevoProducto.categoria_complemento" name="categoria_complemento">
          <option value="">Selecciona una categorÃ­a</option>
          <option *ngFor="let cat of categoriasComplementoNovio" [value]="cat">{{ cat }}</option>
        </select>
      </div>

      <!-- Tallas para Vestidos y Trajes -->
      <div class="form-group" *ngIf="tipoFormulario === 'vestido' || tipoFormulario === 'traje'">
        <label>Tallas Disponibles (separadas por coma) *</label>
        <input type="text" [(ngModel)]="nuevoProducto.tallas_disponibles" name="tallas" placeholder="36,38,40,42">
      </div>

      <div class="form-group">
        <label>DescripciÃ³n Corta *</label>
        <textarea [(ngModel)]="nuevoProducto.descripcion" name="descripcion" rows="3" required></textarea>
      </div>

      <div class="form-group">
        <label>DescripciÃ³n Detallada</label>
        <textarea [(ngModel)]="nuevoProducto.descripcion_larga" name="descripcion_larga" rows="5"></textarea>
      </div>

      <div class="form-group">
        <label>URL Imagen Principal *</label>
        <input type="url" [(ngModel)]="nuevoProducto.imagen_principal" name="imagen_principal" placeholder="https://...">
      </div>

      <div class="form-group">
        <label>URLs ImÃ¡genes Adicionales (separadas por coma)</label>
        <input type="text" [(ngModel)]="nuevoProducto.imagenes_adicionales" name="imagenes_adicionales" placeholder="https://...,https://...">
      </div>

      <div class="form-group">
        <label>CaracterÃ­sticas (separadas por coma)</label>
        <textarea [(ngModel)]="nuevoProducto.caracteristicas" name="caracteristicas" rows="2" placeholder="Alta calidad,DiseÃ±o exclusivo"></textarea>
      </div>

      <div class="form-group checkbox-group">
        <label>
          <input type="checkbox" [(ngModel)]="nuevoProducto.disponible" name="disponible">
          Producto disponible
        </label>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-cancelar" (click)="cerrarFormulario()">Cancelar</button>
        <button type="submit" class="btn-guardar">Guardar Producto</button>
      </div>
    </form>
  </div>
</div>